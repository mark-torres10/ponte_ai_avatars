name: CI - Comprehensive

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  frontend:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Run linting
      run: npm run lint
      
    - name: Build frontend
      run: npm run build
      
  backend:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        
    - name: Install dependencies
      run: |
        cd backend
        npm ci
        
    - name: Run linting
      run: |
        cd backend
        npm run lint
        
    - name: Build backend
      run: |
        cd backend
        npm run build
        
    - name: Run tests
      run: |
        cd backend
        npm test
        
  build-verification:
    runs-on: ubuntu-latest
    needs: [frontend, backend]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        
    - name: Verify both builds work together
      run: |
        echo "ðŸ” Verifying frontend build..."
        npm ci
        npm run build
        
        echo "ðŸ” Verifying backend build..."
        cd backend
        npm ci
        npm run build
        
        echo "âœ… All builds completed successfully!"
        echo "âœ… Frontend and backend are compatible"
        
    - name: Create build summary
      run: |
        echo "## Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Frontend build: PASSED" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Backend build: PASSED" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Backend tests: PASSED" >> $GITHUB_STEP_SUMMARY
        echo "âœ… TypeScript compilation: PASSED" >> $GITHUB_STEP_SUMMARY
        echo "âœ… All checks completed successfully" >> $GITHUB_STEP_SUMMARY 